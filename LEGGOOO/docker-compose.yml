# LEGGOOO Development Docker Compose
# Usage: docker-compose up

version: '3.8'

services:
  # Frontend - React + Vite
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: development
    ports:
      - "5173:5173"
    volumes:
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:3001
      - VITE_WS_URL=ws://localhost:1234
    depends_on:
      - backend
      - yjs-server
    networks:
      - leggooo-network

  # Backend - Express API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
      target: development
    ports:
      - "3001:3001"
    volumes:
      - ./backend/src:/app/src
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - PORT=3001
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
      - JWT_ACCESS_SECRET=${JWT_ACCESS_SECRET}
      - JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET}
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - AI_PROVIDER=${AI_PROVIDER:-openai}
    networks:
      - leggooo-network

  # Yjs WebSocket Server
  yjs-server:
    build:
      context: ./backend
      dockerfile: Dockerfile.yjs
    ports:
      - "1234:1234"
    environment:
      - PORT=1234
      - JWT_ACCESS_SECRET=${JWT_ACCESS_SECRET}
    networks:
      - leggooo-network

networks:
  leggooo-network:
    driver: bridge

# To use this file:
# 1. Copy .env.example to .env and fill in values
# 2. Run: docker-compose up
# 3. Access frontend at http://localhost:5173
